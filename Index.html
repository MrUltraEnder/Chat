<html lang="es">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />

    <style>
        #alto {
            height: 100%;
        }
        
        .bg-pink {
            background-color: pink;
        }
        
        .bg-purple {
            background-color: purple;
        }
        
        .bg-orange {
            background-color: orange;
        }
        
        .bg-green {
            background-color: green;
        }
        
        .bg-black {
            background-color: black;
        }
        
        .bg-blue {
            background-color: blue;
        }
    </style>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

</head>

<body>


    <template id="mensaje_chat">
        <div class="card mb-2 {COLOR} text-white">
            <div class="card-body">
                <img src="{IMAGEN}" id ={perfil} class='rounded float-start me-4' width='100px' height="100px"></img>
                <h6 class="card-title">{NOMBRE_PERSONAJE}</h6>
                {MENSAJE}
                <footer><em>{TIEMPO}</em></footer>
            </div>
        </div></template>
    <div id="cortinilla" class="bg-dark text-white w-100 h-100 fixed-top d-flex  animate__slower" onclick="desvanecer()">
        <div class="w-100 my-auto text-center">
            <p id="textoC" class="fs-1">Esta historia está basada en hechos reales</p>
            <p class="animate__animated animate__pulse animate__infinite">(Haz click para comenzar)</p>
        </div>
    </div>
    <div id='alto' class=" bg-dark d-flex w-25 ">
        <div id="mensajes" class="mt-auto  h-100">

            <div class="card mb-2 ">
                <div class="card-body">
                    ❗ Presiona Intro para comenzar
                </div>
            </div>
        </div>


    </div>
    <script>
        var canMove = false;
        var mensaje_template = document.getElementById("mensaje_chat").innerHTML;
        var i = 0;
        var mensajes = null;
        fetch('./mensajes.json').then(response => response.json()).then(lectura);

        document.addEventListener("keydown", tecleo);

        function tecleo(evento) {
            if (evento.code == 'Enter' && i < mensajes.length && canMove) {
                var html = mensaje_template;

                html = html.replace("{NOMBRE_PERSONAJE}", mensajes[i].nombre_personaje);
                html = html.replace("{MENSAJE}", mensajes[i].mensaje);
                html = html.replace("{IMAGEN}", mensajes[i].imagen_de_perfil);
                html = html.replace("{TIEMPO}", mensajes[i].hora_de_envio);
                html = html.replace("{COLOR}", mensajes[i].color);
                document.getElementById("mensajes").innerHTML += html;
                window.scrollTo(0, document.body.scrollHeight);
                i++;
            }
            if (evento.code == 'Enter' && i == mensajes.length) {
                aparecer();
            }
        }

        function lectura(respuesta) {
            mensajes = respuesta;
        }

        function aparecer() {
            document.getElementById("textoC").innerHTML = "Mientras tanto Juan...";
            document.getElementById("cortinilla").classList.remove("animate__fadeOut");
            document.getElementById("cortinilla").classList.add("animate__fadeIn");
            canMove = false;
        }

        function desvanecer() {
            document.getElementById("cortinilla").classList.remove("animate__animated");

            document.getElementById("cortinilla").classList.remove("animate__fadeIn");
            document.getElementById("cortinilla").classList.add("animate__fadeOut");
            document.getElementById("cortinilla").classList.add("animate__animated");
            canMove = true;
        }
    </script>

</body>

</html>